# Mystery shared cards deck

## User stories

### Deck initialization

**As the game system**,
I want to **create shared deck of mystery effect cards**,
so that **players can interact with it throughout the game**.

**As the game system**,
I want to **shuffle the shared deck content**,
so that **players aren't able to predict the order of the cards**.

### Player interactions

#### Drawing mechanism

**As a registered player with enough coins**,
I want to **draw a card from the shared deck**,
so that **the game state can change in an unpredictable fashion**.

**As the game system**,
I want to **destroy the mystery card after it was drawn**,
so that **the player won't be able to use the same card twice**.

#### Card effects

**As the game system**,
I want to **apply the effect of the mystery card to the game state after it was drawn**,
so that **the game state is changed**.

##### Deck manipulation

**As a registered player with enough coins**,
I want to **draw a card from the shared deck**,
so that **the game state can change in an unpredictable fashion**.

##### Peek at the deck

**As a registered player with enough coins**,
I want to **draw a card from the shared deck**,
so that **the game state can change in an unpredictable fashion**.

##### Draw from the deck

**As a registered player with enough coins**,
I want to **draw a card from the shared deck**,
so that **the game state can change in an unpredictable fashion**.

##### Add cards

**As a registered player with enough coins**,
I want to be able to **add specific cards at specific positions in the shared deck** after I paid for it,
so that **the game state can change in an unpredictable fashion**.

**As the game system**,
I want to **add specific cards at specific positions in the shared deck** at the request of player that paid for it,
so that **players aren't able to predict the order of the cards**.

##### Remove cards

**As a registered player with enough coins**,
I want to be able to **remove specific cards at specific positions in the shared deck** after I paid for it,
so that **the game state can change in an unpredictable fashion**.

**As the game system**,
I want to **remove specific cards at specific positions in the shared deck** at the request of player that paid for it,
so that **players aren't able to predict the order of the cards**.

##### Shuffle

**As a registered player with enough coins**,
I want to be able to **randomize the order of the cards left in the shared deck** after I paid for it,
so that **the game state can change in an unpredictable fashion**.

**As the game system**,
I want to **randomize the order of the cards left in the shared deck** after a player paid for it,
so that **players aren't able to predict the order of the cards**.

## Technical breakdown

Tournament management is built on a permissionless system where game designers can create Bad Debt Tycoon games with customizable rules.

The mystery shared cards deck operates on 2 systems :

1. a **public system** that defines the rules the mystery deck follows (like what sorts of cards are available, how much drawing from the deck costs, etc) that applies the entry/exit effects:

- the "entry" is the amount of coins required to interact with the deck in the fashion
- the "exit" is applying whatever effects the card has

2. a **private, gated system** that allow players to interact with the mystery deck (_actually_ drawing from the deck, _actually_ peaking at the first N cards...)

Randomness is central to how the private system operates, which puts it at odds with the **trust** requirement some players might demand: since the part that determines the outcome of the player action is _private_, **how do we ensure it isn't biased** ?
The answer to that could be to make this private system follow **deterministic randomness**: if the initial conditions are known, then the outcome can be determined. The initial condition in this case is a seed number, which we can produce through VRF ; along with a secret generated by the private system, we can use these to create a seed number. When passed to [pseudorandom number generator](<https://en.wikipedia.org/wiki/List_of_random_number_generators#Pseudorandom_number_generators_(PRNGs)>), we can produce the same suite of number. This reconstructed seed is, during the tournament, not fully known/accessible, and can be revealed a the end of the game for players that wish to verify the game state.

### System requirements

This system would be built following a hybrid model: part of it onchain, part of it on a more "traditional" backend.

(Part of) the seed can be generated onchain with Pyth Entropy. When a player "shuffles" the deck, they would essentially change that part of the seed.

Instead of having the action logic onchain (which would be too complex and/or expensive ?), the deck action logic lives in the Bad Debt Tycoon backend, which already takes care of the matchmaking and combat systems.
